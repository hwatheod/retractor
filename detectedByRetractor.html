<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 //EN">

<html lang="en">
<head>
    <title>Retractor 2</title>
    <meta charset="UTF-8" content="Retractor 2">
</head>
<h2>Illegal positions detected by Retractor 2</h2>
<p>
	Retractor 2 catches all of the following illegal retractions. Note: In the following, a “pseudo-legal move” is a
    move that is legal only by virtue of reversing to a legal move for that piece in forward-play chess in terms of
    piece movement direction, and does not consider any other criterion for legality, including those involving checks.
<p>

    <ol>
    <li>Any move that is not pseudo-legal.</li>
    <li>Placing the opposing king in check.</li>
    <li>Placing the mover’s own king in check by 3 or more pieces.</li>
    <li>Placing the mover’s own king in double check, unless:</li>
    <ul>
        <li> One of the checking pieces can pseudo-legally move onto the line of the other without also giving check.</li>
	<li> One of the checking pieces is on the eighth rank, and can (pseudo-legally) unpromote onto the line of the other check without the resulting
        unpromoted pawn giving check.</li>
	<li> Of the two checking pieces, one is a vertical and the other a diagonal mover, and the checking pieces and king are
        positioned such that there is a pawn on the appropriate square to make an en passant uncapture that covers both checking
        lines simultaneously.</li>
    </ul>
    <li>Placing the mover’s own king in single check by a pawn that has no retreat square.</li>
    <li>Illegalities resulting from built-in <a href="cages.html" target="_blank">cages</a>.</li>
    <li>Positions which contain a verified user-specified cage.</li>
    <li>Illegal pawn structures.</li>
    <li>Count illegalities: too many captures, too many pawns, too many promoted pieces.</li>
</ol>

<h3>Promoted pieces deduced by Retractor 2</h3>
<ul>
    <li>pieces in excess of the original count (3 rooks, 2 dark-squared bishops, etc.)</li>
    <li>user-marked promoted pieces</li>
    <li>pieces deduced to be promoted as a result of a <a href="cages.html" target="_blank">cage</a>.</li>
</ul>

<h3>Captures deduced by Retractor 2</h3>
<ul>
    <li>pawn captures by pawns currently on the board</li>
    <li>pawn captures by promoted pawns when the promoted piece is currently on the board (see details in the next section below)</li>
    <li>captures of pieces from <a href="cages.html" target="_blank">cages</a></li>
</ul>

<h3>How Retractor infers promotion squares for promoted pieces</h3>
<ul>
    <li>A promoted queen, rook, or knight could come from any of the 8 promotion squares.</li>
    <li>A promoted bishop could come from any of the 4 promotion squares of the right color.</li>
    <li>No promotions are possible on a square if all 3 (or 2 on an edge file) adjacent squares on the 7th rank are occupied by enemy pawns.</li>
    <li>No promotions are possible on a square with a frozen piece.</li>
    <li>A rook promotion in a <a href="cages.html" target="_blank">weak cage</a> is only possible if the rook is currently in the cage.</li>
    <li>In case of a configuration like wPc2, wPe2, a Black bishop promotion on d1 is only possible if the bishop is currently on d1.</li>
    <li>In case of a configuration in the corner like wPb2, wPb3, wPc2, a Black bishop promotion on b1 is only possible if the bishop is currently on b1 or a2.</li>
</ul>
</html>